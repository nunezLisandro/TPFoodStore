<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Visor de Base de Datos - FoodStore</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .btn { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; cursor: pointer; }
        .btn:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üóÑÔ∏è Visor de Base de Datos - FoodStore</h1>
        
        <div class="section">
            <h2>Acciones</h2>
            <button class="btn" onclick="loadUsers()">üë• Cargar Usuarios</button>
            <button class="btn" onclick="loadProducts()">üì¶ Cargar Productos</button>
            <button class="btn" onclick="loadCategories()">üìÇ Cargar Categor√≠as</button>
            <button class="btn" onclick="loadOrders()">üìã Cargar Pedidos</button>
            <button class="btn" onclick="clearAll()">üßπ Limpiar</button>
        </div>

        <div class="section">
            <h2>Resultados</h2>
            <div id="results"></div>
        </div>

        <div class="section">
            <h2>Informaci√≥n de Conexi√≥n H2</h2>
            <pre>
URL: http://localhost:8081/h2-console

Configuraci√≥n de conexi√≥n:
- JDBC URL: jdbc:h2:file:./data/foodstore  
- User Name: sa
- Password: password
- Driver Class: org.h2.Driver
            </pre>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8081/api';

        async function apiCall(endpoint) {
            try {
                const response = await fetch(`${API_URL}${endpoint}`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                return { error: error.message };
            }
        }

        function displayData(title, data) {
            const resultsDiv = document.getElementById('results');
            
            if (data.error) {
                resultsDiv.innerHTML = `<h3>${title}</h3><p style="color: red;">Error: ${data.error}</p>`;
                return;
            }

            if (!Array.isArray(data) || data.length === 0) {
                resultsDiv.innerHTML = `<h3>${title}</h3><p>No hay datos disponibles</p>`;
                return;
            }

            const keys = Object.keys(data[0]);
            let tableHTML = `
                <h3>${title}</h3>
                <p>Total de registros: ${data.length}</p>
                <table>
                    <thead>
                        <tr>${keys.map(key => `<th>${key}</th>`).join('')}</tr>
                    </thead>
                    <tbody>
            `;

            data.forEach(item => {
                tableHTML += `<tr>${keys.map(key => `<td>${JSON.stringify(item[key]) || ''}</td>`).join('')}</tr>`;
            });

            tableHTML += `</tbody></table>`;
            resultsDiv.innerHTML = tableHTML;
        }

        async function loadUsers() {
            const data = await apiCall('/users');
            displayData('üë• Usuarios', data);
        }

        async function loadProducts() {
            const data = await apiCall('/productos');
            displayData('üì¶ Productos', data);
        }

        async function loadCategories() {
            const data = await apiCall('/categorias');
            displayData('üìÇ Categor√≠as', data);
        }

        async function loadOrders() {
            const data = await apiCall('/pedidos');
            displayData('üìã Pedidos', data);
        }

        function clearAll() {
            document.getElementById('results').innerHTML = '<p>Resultados limpiados</p>';
        }

        window.onload = () => loadProducts();
    </script>
</body>
</html>